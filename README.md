# Super Resolution Impl

## これは何？

超解像技術であるESPCNとEDSRの勉強用リポジトリです。

## 用意するもの

- pytorch

必須。学習するのに使います。

- python3-opencv

任意。学習に使用する画像を生成するのに使います。

- python3-onnx

任意。PytorchのモデルをONNXに変換するのに使います。

- onnxruntime

任意。python3-onnxで作ったモデルを利用するのに使います。

- stb

任意。C++で画像を読み書きするのに使います。

## モデルの学習に関して

- 1チャンネルのinput

画像のRGBいずれか1チャンネルを入力として学習しています。
RGBの3チャンネルの入力ではないので注意してください。

- RGBAでの変換

ESPCNはYCbCrに変換してYだけをモデルを利用して変換する(人間の認識はYの重みが大きいのでそれで十分)と論文に書かれていますが、このリポジトリではRGBA各チャンネルに対して変換処理を行っています。
ただし、RGBAを一括で変換せず、各チャンネルそれぞれ変換した後くっつけています。
学習に適したRGBA画像、というものが思いつかなかったため。

- ガウスぼかしを利用しない

ESPCNの論文ではガウスぼかしを入れてから縮小させていますが、伺か的には元にする画像も十分綺麗なため、学習処理で画像をぼかすと逆にシャープ処理が強く出すぎてしまいます。
そのため、このリポジトリではガウスぼかしを利用していません。
(ちょっとだけならぼかしてもいいのかもしれません)

## edsr

EDSR…はそのままだとCPUでやるにはちょっと時間が掛かりすぎるので
適当にモデルをスケールダウンしたものになっています。
(B = 32, F = 256 , scale\_factor = 0.1 -> B = 8, F = 256, scale\_factor = 1.0)
学習するには`learn.py`を実行すればOKです。

## espcn

ネットワークの構成は論文どおり…のはずです。
学習するには`learn.py`を実行すればOKです。

## utils

- black.py

白背景に黒い線/矢印/矩形/ポリゴン/楕円等を描画した画像を50枚作ります。

- convert.py

pytorchのモデルをonnxのモデルに変換します。引数はモデルのファイル名。

- predict.py

`input.png`を2倍にした画像`output.png`を作り出します。引数はモデルのファイル名。

- random\_image\_generator.py

黒背景にランダムな色の線/矢印/矩形/ポリゴン/楕円等を描画した画像を400枚作ります。

- white.py

黒背景に白い線/矢印/矩形/ポリゴン/楕円等を描画した画像を50枚作ります。

## 注意

onnxruntimeはもしかしたら自分でビルドする必要があるかもしれません。(エラーがたくさん出て失敗するため)
その場合はCMakeが必要になったり`pip install cmake`する必要があると思います。
